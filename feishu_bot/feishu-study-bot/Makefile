.PHONY: help dev install build up down restart logs clean test db-init

# é»˜è®¤ç›®æ ‡
help:
	@echo "é£žä¹¦å­¦ä¹ æœºå™¨äºº - å¸¸ç”¨å‘½ä»¤"
	@echo ""
	@echo "å¼€å‘å‘½ä»¤:"
	@echo "  make install     - å®‰è£…ä¾èµ– (ä½¿ç”¨ uv)"
	@echo "  make dev         - å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
	@echo "  make db-init     - åˆå§‹åŒ–æ•°æ®åº“"
	@echo "  make test        - è¿è¡Œæµ‹è¯•"
	@echo ""
	@echo "Docker å‘½ä»¤:"
	@echo "  make build       - æž„å»º Docker é•œåƒ"
	@echo "  make up          - å¯åŠ¨æœåŠ¡"
	@echo "  make down        - åœæ­¢æœåŠ¡"
	@echo "  make restart     - é‡å¯æœåŠ¡"
	@echo "  make logs        - æŸ¥çœ‹æ—¥å¿—"
	@echo "  make clean       - æ¸…ç†å®¹å™¨å’Œé•œåƒ"

# å®‰è£…ä¾èµ–
install:
	@echo "ðŸ“¦ å®‰è£…ä¾èµ–..."
	uv sync --all-extras

# å¼€å‘æ¨¡å¼å¯åŠ¨
dev:
	@echo "ðŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
	uv run python app.py

# åˆå§‹åŒ–æ•°æ®åº“
db-init:
	@echo "ðŸ—„ï¸  åˆå§‹åŒ–æ•°æ®åº“..."
	uv run python -c "from models.database import init_db; init_db()"

# è¿è¡Œæµ‹è¯•
test:
	@echo "ðŸ§ª è¿è¡Œæµ‹è¯•..."
	uv run pytest -v

# Docker æž„å»º
build:
	@echo "ðŸ—ï¸  æž„å»º Docker é•œåƒ..."
	docker-compose build

# Docker å¯åŠ¨
up:
	@echo "ðŸš€ å¯åŠ¨æœåŠ¡..."
	docker-compose up -d

# Docker åœæ­¢
down:
	@echo "ðŸ›‘ åœæ­¢æœåŠ¡..."
	docker-compose down

# Docker é‡å¯
restart:
	@echo "ðŸ”„ é‡å¯æœåŠ¡..."
	docker-compose restart

# æŸ¥çœ‹æ—¥å¿—
logs:
	docker-compose logs -f

# æ¸…ç†
clean:
	@echo "ðŸ§¹ æ¸…ç†..."
	docker-compose down -v --remove-orphans
	docker image rm feishu-study-bot:latest 2>/dev/null || true
